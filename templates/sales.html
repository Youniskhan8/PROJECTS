<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Submit Sale</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='analysis_style.css') }}">
</head>

<body>
    <div class="topbar">
        <button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
        <h1>
          <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo"> Agri Forecast
        </h1>
      </div>
    
      <!-- Sidebar Navigation -->
      
    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
      <a href="{{ url_for('home_page') }}" class="nav-link">
        üè† Home
      </a>
      <a href="{{ url_for('analysis') }}" class="nav-link">
        üìà Analysis
      </a>
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('profile') }}" class="nav-link">
          üë§ Profile
        </a>
        <a href="{{ url_for('sales') }}" class="nav-link">
          üìä Sales Data
        </a>
        <a href="{{ url_for('logout') }}" class="nav-link">
          üîì Logout
        </a>
      {% else %}
        <a href="{{ url_for('login') }}" class="nav-link">
          üîê Login
        </a>
      {% endif %}
    </div>
    <section id="main-content">
        <div class="title">
            <h2>Submit Your Sale</h2>
        </div>

        <div class="container">
            <form method="POST" action="/submit_sale">
                <div class="container_top">
                    <div>
                        <label for="commodity">Commodity:</label>
                        <select id="commodity" name="commodity" onchange="updateVarieties()" required>
                            <option value="" disabled selected>Select</option>
                            {% for item in dropdowns['commodities'] %}
                            <option value="{{ item }}">{{ item }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div>
                        <label for="variety">Variety:</label>
                        <select id="variety" name="variety" onchange="updateGrades()" required>
                            <option value="" disabled selected>Select</option>
                        </select>
                    </div>

                    <div>
                        <label for="grade">Grade:</label>
                        <select id="grade" name="grade" required>
                            <option value="" disabled selected>Select</option>
                        </select>
                    </div>

                    <div>
                        <label for="district">District:</label>
                        <select id="district" name="district" onchange="updateMarkets()" required>
                            <option value="" disabled selected>Select</option>
                            {% for item in dropdowns['districts'] %}
                            <option value="{{ item }}">{{ item }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div>
                        <label for="market">Market:</label>
                        <select id="market" name="market" required>
                            <option value="" disabled selected>Select</option>
                        </select>
                    </div>

                    <div>
                        <label for="price">Price (‚Çπ):</label>
                        <input type="number" name="price" id="price" step="0.01" required>
                    </div>

                    <div>
                        <label for="date">Date of Sale:</label>
                        <input type="date" name="price_date" id="date" max="" required>
                    </div>
                </div>

                <div class="container_bottom">
                    <button class="result_button" type="submit">Submit Sale</button>
                </div>
            </form>

           

    <script>
        async function updateVarieties() {
            const commodity = document.getElementById("commodity").value;
            const res = await fetch("/get_options", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ type: "commodity", value: commodity })
            });
            const data = await res.json();
            const varietySelect = document.getElementById("variety");
            varietySelect.innerHTML = "<option value='' disabled selected>Select</option>";
            data.options.forEach(option => {
                varietySelect.innerHTML += `<option value="${option}">${option}</option>`;
            });
        }

        async function updateGrades() {
            const variety = document.getElementById("variety").value;
            const res = await fetch("/get_options", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ type: "variety", value: variety })
            });
            const data = await res.json();
            const gradeSelect = document.getElementById("grade");
            gradeSelect.innerHTML = "<option value='' disabled selected>Select</option>";
            data.options.forEach(option => {
                gradeSelect.innerHTML += `<option value="${option}">${option}</option>`;
            });
        }

        async function updateMarkets() {
            const district = document.getElementById("district").value;
            const res = await fetch("/get_options", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ type: "district", value: district })
            });
            const data = await res.json();
            const marketSelect = document.getElementById("market");
            marketSelect.innerHTML = "<option value='' disabled selected>Select</option>";
            data.options.forEach(option => {
                marketSelect.innerHTML += `<option value="${option}">${option}</option>`;
            });
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const content = document.getElementById('main-content');
            const isHidden = sidebar.classList.toggle('hidden');
            content.classList.toggle('full', isHidden);
        }
    </script>

    <script>
        // Set max date to today
        document.addEventListener("DOMContentLoaded", () => {
            const today = new Date().toISOString().split("T")[0];
            document.getElementById("date").setAttribute("max", today);
        });
    </script>
</body>

</html>
